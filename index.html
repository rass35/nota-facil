<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Notas Rápidas com Alarme, Selecionar e Compartilhar</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 p-6">
  <div class="max-w-2xl mx-auto bg-white p-6 rounded shadow">
    <h1 class="text-2xl font-bold mb-4 text-center">📝 Notas Rápidas com Alarme</h1>

    <label class="block mb-2">Título da Nota</label>
    <input
      type="text"
      id="note-title"
      class="w-full border p-2 rounded mb-4"
      placeholder="Título da nota..."
    />

    <label class="block mb-2">
      <input type="checkbox" id="toggle-list" class="mr-2" /> Esta é uma lista de tarefas
    </label>

    <textarea
      id="note-content"
      rows="5"
      class="w-full border p-2 rounded mb-4"
      placeholder="Digite sua nota..."
    ></textarea>

    <div id="task-container" style="display:none;">
      <input
        type="text"
        id="new-task"
        placeholder="Digite uma tarefa e pressione Enter"
        class="w-full border p-2 rounded mb-4"
      />
      <ul id="task-list" class="list-disc pl-5"></ul>
    </div>

    <label class="block mb-2">Data e Hora do Alarme (opcional):</label>
    <input
      type="datetime-local"
      id="note-alarm"
      class="w-full border p-2 rounded mb-4"
      placeholder="Escolha data e hora para alarme"
    />

    <div class="flex gap-2 mb-4">
      <button id="btn-save" class="bg-green-600 text-white px-4 py-2 rounded">💾 Salvar</button>
      <button id="btn-clear" class="bg-gray-400 text-white px-4 py-2 rounded">🗑️ Limpar Tudo</button>
      <button id="btn-select-all" class="bg-blue-600 text-white px-4 py-2 rounded">📋 Selecionar Tudo</button>
      <button id="btn-share" class="bg-purple-600 text-white px-4 py-2 rounded">📤 Compartilhar</button>
    </div>

    <hr class="my-4" />

    <h2 class="text-xl font-semibold mb-2">Minhas Notas</h2>
    <div id="notes-list"></div>
  </div>

  <script>
    const toggleList = document.getElementById("toggle-list");
    const noteContent = document.getElementById("note-content");
    const taskContainer = document.getElementById("task-container");
    const newTaskInput = document.getElementById("new-task");
    const taskList = document.getElementById("task-list");
    const noteTitle = document.getElementById("note-title");
    const btnSave = document.getElementById("btn-save");
    const btnClear = document.getElementById("btn-clear");
    const btnSelectAll = document.getElementById("btn-select-all");
    const btnShare = document.getElementById("btn-share");
    const notesList = document.getElementById("notes-list");
    const noteAlarm = document.getElementById("note-alarm");

    let editingNoteId = null;

    toggleList.addEventListener("change", () => {
      if (toggleList.checked) {
        noteContent.style.display = "none";
        taskContainer.style.display = "block";
      } else {
        noteContent.style.display = "block";
        taskContainer.style.display = "none";
      }
    });

    newTaskInput.addEventListener("keypress", (e) => {
      if (e.key === "Enter" && newTaskInput.value.trim() !== "") {
        addTask(newTaskInput.value.trim());
        newTaskInput.value = "";
        e.preventDefault();
      }
    });

    function addTask(text, done = false) {
      const li = document.createElement("li");
      li.className = "flex items-center gap-2";
      
      const checkbox = document.createElement("input");
      checkbox.type = "checkbox";
      checkbox.checked = done;
      checkbox.addEventListener("change", saveTasks);

      const label = document.createElement("label");
      label.textContent = text;

      li.appendChild(checkbox);
      li.appendChild(label);
      taskList.appendChild(li);

      saveTasks();
    }

    function saveTasks() {
      const tasks = [];
      taskList.querySelectorAll("li").forEach((li) => {
        const checkbox = li.querySelector('input[type="checkbox"]');
        const label = li.querySelector("label");
        tasks.push({ text: label.textContent, done: checkbox.checked });
      });
      return tasks;
    }

    btnSave.addEventListener("click", () => {
      const title = noteTitle.value.trim() || "Sem título";
      const isList = toggleList.checked;
      const content = isList ? saveTasks() : noteContent.value.trim();
      const alarmDateTime = noteAlarm.value;

      let notes = JSON.parse(localStorage.getItem("notes") || "[]");

      if (editingNoteId) {
        notes = notes.map((note) =>
          note.id === editingNoteId
            ? {
                ...note,
                title,
                content,
                isList,
                alarm: alarmDateTime ? new Date(alarmDateTime).getTime() : null,
                alarmTriggered: false,
              }
            : note
        );
        editingNoteId = null;
      } else {
        notes.push({
          id: Date.now(),
          title,
          content,
          isList,
          alarm: alarmDateTime ? new Date(alarmDateTime).getTime() : null,
          alarmTriggered: false,
          isFavorite: false,
        });
      }

      localStorage.setItem("notes", JSON.stringify(notes));
      renderNotes();
      clearFields();
    });

    btnClear.addEventListener("click", () => {
      if (confirm("Tem certeza que deseja limpar todas as notas?")) {
        localStorage.removeItem("notes");
        clearFields();
        renderNotes();
      }
    });

    btnSelectAll.addEventListener("click", () => {
      let textToSelect = "";
      if (toggleList.checked) {
        const texts = [];
        taskList.querySelectorAll("li").forEach((li) => {
          texts.push(li.textContent.trim());
        });
        textToSelect = texts.join("\n");
      } else {
        textToSelect = noteContent.value;
      }
      selectText(textToSelect);
      alert("Texto selecionado e copiado para a área de transferência.");
    });

    btnShare.addEventListener("click", () => {
      let textToShare = noteTitle.value.trim() + "\n\n";
      if (toggleList.checked) {
        const tasks = [];
        taskList.querySelectorAll("li").forEach((li) => {
          tasks.push(li.textContent.trim());
        });
        textToShare += tasks.join("\n");
      } else {
        textToShare += noteContent.value.trim();
      }

      if (navigator.share) {
        navigator
          .share({
            title: noteTitle.value || "Nota",
            text: textToShare,
          })
          .catch((error) => alert("Erro ao compartilhar: " + error));
      } else {
        copyToClipboard(textToShare);
        alert("Conteúdo copiado para a área de transferência!");
      }
    });

    function selectText(text) {
      const textarea = document.createElement("textarea");
      textarea.value = text;
      document.body.appendChild(textarea);
      textarea.select();
      document.execCommand("copy");
      document.body.removeChild(textarea);
    }

    function copyToClipboard(text) {
      if (navigator.clipboard) {
        navigator.clipboard.writeText(text).catch(() => fallbackCopy(text));
      } else {
        fallbackCopy(text);
      }
    }

    function fallbackCopy(text) {
      const textarea = document.createElement("textarea");
      textarea.value = text;
      document.body.appendChild(textarea);
      textarea.select();
      document.execCommand("copy");
      document.body.removeChild(textarea);
    }

    function clearFields() {
      noteTitle.value = "";
      noteContent.value = "";
      taskList.innerHTML = "";
      toggleList.checked = false;
      noteContent.style.display = "block";
      taskContainer.style.display = "none";
      noteAlarm.value = "";
      editingNoteId = null;
    }

    function renderNotes() {
      const notes = JSON.parse(localStorage.getItem("notes") || "[]");

      if (notes.length === 0) {
        notesList.innerHTML = '<p class="text-gray-500">Nenhuma nota salva.</p>';
        return;
      }

      // Ordenar favoritos no topo
      notes.sort((a, b) => b.isFavorite - a.isFavorite);

      notesList.innerHTML = "";
      notes.forEach((note) => {
        const div = document.createElement("div");
        // Corrigido: template string correta com backticks
        div.className = `border p-4 mb-2 rounded ${
          note.isFavorite ? "border-yellow-500 bg-yellow-50" : "border-gray-300"
        }`;

        const header = document.createElement("div");
        header.className = "flex justify-between items-center mb-2";

        const title = document.createElement("h3");
        title.textContent = note.title;
        title.className = "font-semibold text-lg";

        const buttons = document.createElement("div");
        buttons.className = "flex gap-2";

        // Botão Editar
        const editBtn = document.createElement("button");
        editBtn.textContent = "✏️";
        editBtn.title = "Editar";
        editBtn.className =
          "bg-blue-500 text-white px-2 py-1 rounded hover:bg-blue-700";
        editBtn.addEventListener("click", () => editNote(note.id));

        // Botão Favoritar
        const favBtn = document.createElement("button");
        favBtn.textContent = note.isFavorite ? "⭐" : "☆";
        favBtn.title = note.isFavorite ? "Desfavoritar" : "Favoritar";
        favBtn.className =
          "bg-yellow-400 text-white px-2 py-1 rounded hover:bg-yellow-600";
        favBtn.addEventListener("click", () => toggleFavorite(note.id));

        // Botão Apagar
        const delBtn = document.createElement("button");
        delBtn.textContent = "🗑️";
        delBtn.title = "Excluir";
        delBtn.className =
          "bg-red-500 text-white px-2 py-1 rounded hover:bg-red-700";
        delBtn.addEventListener("click", () => deleteNote(note.id));

        buttons.appendChild(editBtn);
        buttons.appendChild(favBtn);
        buttons.appendChild(delBtn);

        header.appendChild(title);
        header.appendChild(buttons);

        div.appendChild(header);

        // Conteúdo da nota
        if (note.isList) {
          const ul = document.createElement("ul");
          ul.className = "list-disc pl-5";
          note.content.forEach((task) => {
            const li = document.createElement("li");
            li.textContent = task.text;
            if (task.done) {
              li.style.textDecoration = "line-through";
              li.style.color = "#777";
            }
            ul.appendChild(li);
          });
          div.appendChild(ul);
        } else {
          const p = document.createElement("p");
          p.textContent = note.content;
          div.appendChild(p);
        }

        // Mostrar data/hora do alarme, se houver
        if (note.alarm) {
          const alarmDate = new Date(note.alarm);
          const alarmDiv = document.createElement("div");
          alarmDiv.className = "mt-2 text-sm text-red-600 font-semibold";
          alarmDiv.textContent =
            "⏰ Alarme: " + alarmDate.toLocaleString("pt-BR");
          div.appendChild(alarmDiv);
        }

        notesList.appendChild(div);
      });
    }

    function editNote(id) {
      const notes = JSON.parse(localStorage.getItem("notes") || "[]");
      const note = notes.find((n) => n.id === id);
      if (!note) return;

      editingNoteId = id;
      noteTitle.value = note.title;

      toggleList.checked = note.isList;
      if (note.isList) {
        noteContent.style.display = "none";
        taskContainer.style.display = "block";
        taskList.innerHTML = "";
        note.content.forEach((task) => addTask(task.text, task.done));
      } else {
        noteContent.style.display = "block";
        taskContainer.style.display = "none";
        noteContent.value = note.content;
      }

      if (note.alarm) {
        noteAlarm.value = new Date(note.alarm).toISOString().slice(0, 16);
      } else {
        noteAlarm.value = "";
      }
    }

    function deleteNote(id) {
      if (!confirm("Deseja realmente apagar esta nota?")) return;
      let notes = JSON.parse(localStorage.getItem("notes") || "[]");
      notes = notes.filter((n) => n.id !== id);
      localStorage.setItem("notes", JSON.stringify(notes));
      renderNotes();
    }

    function toggleFavorite(id) {
      let notes = JSON.parse(localStorage.getItem("notes") || "[]");
      notes = notes.map((note) =>
        note.id === id ? { ...note, isFavorite: !note.isFavorite } : note
      );
      localStorage.setItem("notes", JSON.stringify(notes));
      renderNotes();
    }

    // Função para verificar alarmes a cada 10 segundos e alertar se algum ativar
    setInterval(() => {
      const now = Date.now();
      let notes = JSON.parse(localStorage.getItem("notes") || "[]");
      let changed = false;
      notes.forEach((note) => {
        if (
          note.alarm &&
          note.alarm <= now &&
          note.alarmTriggered !== true
        ) {
          alert(
            `⏰ Alarme disparado para a nota: "${note.title}"`
          );
          note.alarmTriggered = true;
          changed = true;
        }
      });
      if (changed) {
        localStorage.setItem("notes", JSON.stringify(notes));
        renderNotes();
      }
    }, 10000);

    // Carregar notas ao abrir a página
    renderNotes();
  </script>
</body>
</html>
